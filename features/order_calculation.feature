# language: ru

Функция: Расчет суммы заказа
  Как администратор системы
  Я хочу чтобы сумма заказа рассчитывалась автоматически
  Чтобы избежать ошибок при расчетах

  Предыстория:
    Дано я авторизован как супер-администратор
    И в системе существует услуга "Боулинг" стоимостью 5000 рублей за человека
    И в системе существует время услуги "1 час" с коэффициентом 1.0
    И в системе существует время услуги "2 часа" с коэффициентом 2.0
    И в системе существует клиент "Иванов Иван Иванович"
    И в системе существует источник "Instagram"

  Сценарий: Базовый расчет суммы заказа
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
    Тогда общая сумма заказа составляет 10000 рублей
    И сумма к оплате составляет 10000 рублей

  Сценарий: Расчет с коэффициентом времени
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 2 часа     |
      | количество    | 2          |
    Тогда общая сумма заказа составляет 20000 рублей
    И сумма к оплате составляет 20000 рублей

  Сценарий: Расчет с обычной скидкой
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
      | скидка        | 1000       |
    Тогда общая сумма заказа составляет 10000 рублей
    И сумма к оплате составляет 9000 рублей

  Сценарий: Расчет с авансом
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
      | аванс         | 3000       |
    Тогда общая сумма заказа составляет 10000 рублей
    И сумма к оплате составляет 7000 рублей

  Сценарий: Расчет с дополнительной скидкой
    Когда я создаю заказ:
      | услуга                      | Боулинг        |
      | время                       | 1 час          |
      | количество                  | 2              |
      | дополнительная_скидка       | 500            |
      | причина_скидки              | День рождения  |
    Тогда общая сумма заказа составляет 10000 рублей
    И сумма к оплате составляет 9500 рублей

  Сценарий: Расчет со всеми видами скидок и авансом
    Когда я создаю заказ:
      | услуга                      | Боулинг        |
      | время                       | 1 час          |
      | количество                  | 2              |
      | скидка                      | 1000           |
      | аванс                       | 2000           |
      | дополнительная_скидка       | 500            |
    Тогда общая сумма заказа составляет 10000 рублей
    И сумма к оплате составляет 6500 рублей
    # Расчет: 5000 * 1.0 * 2 - 1000 - 2000 - 500 = 6500

  Сценарий: Автоматический пересчет при изменении количества
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
    Тогда сумма к оплате составляет 10000 рублей
    Когда я изменяю количество человек на 3
    Тогда общая сумма заказа автоматически пересчитывается на 15000 рублей
    И сумма к оплате составляет 15000 рублей

  Сценарий: Автоматический пересчет при изменении времени
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
    Тогда сумма к оплате составляет 10000 рублей
    Когда я изменяю время услуги на "2 часа"
    Тогда общая сумма заказа автоматически пересчитывается на 20000 рублей
    И сумма к оплате составляет 20000 рублей

  Сценарий: Автоматический пересчет при изменении скидки
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
      | скидка        | 1000       |
    Тогда сумма к оплате составляет 9000 рублей
    Когда я изменяю скидку на 2000 рублей
    Тогда сумма к оплате автоматически пересчитывается на 8000 рублей

  Сценарий: Автоматический пересчет при изменении аванса
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
      | аванс         | 3000       |
    Тогда сумма к оплате составляет 7000 рублей
    Когда я изменяю аванс на 5000 рублей
    Тогда сумма к оплате автоматически пересчитывается на 5000 рублей

  Сценарий: Пересчет суммы первой оплаты при изменении параметров
    Когда я создаю заказ:
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
    Тогда первая оплата безналичными автоматически устанавливается на 10000 рублей
    Когда я изменяю количество человек на 3
    Тогда первая оплата безналичными автоматически обновляется на 15000 рублей

  Сценарий: Расчет для тарифа с фиксированным количеством человек
    Дано в системе существует тариф "4 человека" с коэффициентом 3.5
    Когда я создаю заказ:
      | услуга        | Боулинг     |
      | тариф         | 4 человека  |
    Тогда количество человек устанавливается в 1
    И общая сумма заказа составляет 17500 рублей
    # Расчет: 5000 * 3.5 * 1 = 17500

  Сценарий: Сумма не пересчитывается при редактировании существующего заказа
    Дано существует заказ:
      | id            | 123        |
      | услуга        | Боулинг    |
      | время         | 1 час      |
      | количество    | 2          |
      | сумма         | 10000      |
    Когда я открываю заказ для редактирования
    И изменяю скидку на 1000 рублей
    Тогда первая оплата не изменяется автоматически
    И я могу вручную скорректировать оплаты

  Сценарий: Расчет с дробными значениями
    Дано в системе существует услуга "Караоке" стоимостью 3333.33 рубля
    И в системе существует время услуги "1.5 часа" с коэффициентом 1.5
    Когда я создаю заказ:
      | услуга        | Караоке    |
      | время         | 1.5 часа   |
      | количество    | 2          |
    Тогда общая сумма заказа составляет 9999.99 рублей
    И сумма к оплате составляет 9999.99 рублей

  Сценарий: Сохранение копеек при расчете
    Дано в системе существует услуга "Бильярд" стоимостью 2500.50 рубля
    Когда я создаю заказ:
      | услуга        | Бильярд    |
      | время         | 1 час      |
      | количество    | 3          |
    Тогда общая сумма заказа составляет 7501.50 рублей
    И копейки сохраняются в расчетах
