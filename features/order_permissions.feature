# language: ru

Функция: Права доступа к заказам
  Как система управления правами
  Я хочу контролировать доступ к функциям заказов
  Чтобы разные роли имели соответствующие права

  Предыстория:
    Дано в системе существует роль "super-admin"
    И в системе существует роль "admin"
    И в системе существует роль "employee"
    И в системе существует заказ на сумму 10000 рублей

  Сценарий: Супер-администратор имеет полный доступ к заказам
    Дано я авторизован как супер-администратор
    Когда я перехожу на страницу заказов
    Тогда я могу создавать новые заказы
    И я могу редактировать заказы
    И я могу удалять заказы
    И я могу просматривать все заказы
    И я могу изменять дату заказа
    И поле "Дата заказа" видимо и доступно для редактирования

  Сценарий: Администратор имеет полный доступ к заказам
    Дано я авторизован как администратор
    Когда я перехожу на страницу заказов
    Тогда я могу создавать новые заказы
    И я могу редактировать заказы
    И я могу удалять заказы
    И я могу просматривать все заказы
    И я могу изменять дату заказа
    И поле "Дата заказа" видимо и доступно для редактирования

  Сценарий: Сотрудник не может изменять дату заказа
    Дано я авторизован как сотрудник
    Когда я перехожу на страницу создания заказа
    Тогда поле "Дата заказа" скрыто
    И дата заказа устанавливается автоматически на текущую дату
    Когда я открываю существующий заказ для редактирования
    Тогда поле "Дата заказа" скрыто
    И я не могу изменить дату заказа

  Сценарий: Сотрудник может создавать заказы
    Дано я авторизован как сотрудник
    Когда я перехожу на страницу заказов
    Тогда я вижу кнопку "Создать заказ"
    И я могу создать новый заказ
    Но дата заказа устанавливается автоматически

  Сценарий: Сотрудник может редактировать заказы
    Дано я авторизован как сотрудник
    И существует заказ созданный мной
    Когда я перехожу на страницу списка заказов
    Тогда я вижу кнопку "Изменить" у заказа
    И я могу отредактировать заказ
    Но я не могу изменить дату заказа

  Сценарий: Сотрудник может удалять заказы при наличии прав
    Дано я авторизован как сотрудник
    И у меня есть право "delete_order"
    Когда я перехожу на страницу списка заказов
    Тогда я вижу кнопку "Удалить" у заказа
    И я могу удалить заказ

  Сценарий: Сотрудник без прав не может удалять заказы
    Дано я авторизован как сотрудник
    И у меня нет права "delete_order"
    Когда я перехожу на страницу списка заказов
    Тогда я не вижу кнопку "Удалить" у заказа
    И я не могу удалить заказ

  Сценарий: Поле времени заказа только для чтения для всех ролей
    Дано я авторизован как <роль>
    Когда я перехожу на страницу создания заказа
    Тогда поле "Время заказа" доступно только для чтения
    И время устанавливается автоматически
    Примеры:
      | роль             |
      | super-admin      |
      | admin            |
      | employee         |

  Сценарий: Поле ID сотрудника скрыто для всех пользователей
    Дано я авторизован как супер-администратор
    Когда я перехожу на страницу создания заказа
    Тогда поле "employee_id" скрыто
    И значение устанавливается автоматически

  Сценарий: Неавторизованный пользователь не имеет доступа
    Дано я не авторизован
    Когда я пытаюсь перейти на страницу заказов
    Тогда я перенаправлен на страницу входа
    И я вижу сообщение "Необходима авторизация"

  Сценарий: Сотрудник видит только свои заказы (если настроено)
    Дано я авторизован как сотрудник
    И политика настроена на показ только своих заказов
    Когда я перехожу на страницу списка заказов
    Тогда я вижу только заказы, где я указан как сотрудник
    И я не вижу заказы других сотрудников

  Сценарий: Администраторы видят все заказы
    Дано я авторизован как администратор
    Когда я перехожу на страницу списка заказов
    Тогда я вижу заказы всех сотрудников
    И фильтр по сотруднику не применяется

  Сценарий: Массовое удаление доступно только администраторам
    Дано я авторизован как сотрудник
    Когда я перехожу на страницу списка заказов
    Тогда функция массового удаления недоступна
    Дано я авторизован как администратор
    Когда я перехожу на страницу списка заказов
    Тогда функция массового удаления доступна
