# language: ru

Функция: Удаление заказа
  Как администратор системы
  Я хочу удалять заказы
  Чтобы удалять ошибочные или отмененные заказы из системы

  Предыстория:
    Дано я авторизован как супер-администратор
    И в системе существует заказ:
      | дата          | 2024-01-15            |
      | время         | 14:00                 |
      | услуга        | Боулинг               |
      | клиент        | Иванов Иван Иванович  |
      | количество    | 2                     |
      | сумма         | 10000                 |

  Сценарий: Удаление заказа из списка
    Когда я перехожу на страницу списка заказов
    И нажимаю кнопку "Удалить" у заказа
    И подтверждаю удаление
    Тогда я вижу сообщение "Заказ успешно удален"
    И заказ удален из системы
    И я не вижу этот заказ в списке

  Сценарий: Удаление заказа со страницы редактирования
    Когда я открываю заказ для редактирования
    И нажимаю кнопку "Удалить"
    И подтверждаю удаление
    Тогда я вижу сообщение "Заказ успешно удален"
    И я перехожу к списку заказов
    И заказ удален из системы

  Сценарий: Отмена удаления заказа
    Когда я перехожу на страницу списка заказов
    И нажимаю кнопку "Удалить" у заказа
    И отменяю удаление
    Тогда заказ остается в системе
    И я вижу этот заказ в списке

  Сценарий: Удаление заказа с оплатами
    Дано заказ имеет 2 оплаты:
      | тип          | сумма |
      | наличные     | 6000  |
      | безналичные  | 4000  |
    Когда я удаляю заказ
    Тогда заказ удален из системы
    И все связанные оплаты также удалены

  Сценарий: Удаление заказа запускает событие OrderDeleting
    Дано система отслеживает события
    Когда я удаляю заказ
    Тогда срабатывает событие "OrderDeleting"
    И событие содержит данные удаляемого заказа

  Сценарий: Массовое удаление заказов
    Дано в системе существует 5 заказов за сегодня
    Когда я перехожу на страницу списка заказов
    И выбираю 3 заказа флажками
    И нажимаю "Удалить выбранные"
    И подтверждаю массовое удаление
    Тогда я вижу сообщение "3 заказа успешно удалены"
    И 3 выбранных заказа удалены из системы
    И остальные 2 заказа остаются в системе

  Сценарий: Права доступа на удаление заказа
    Дано я авторизован как сотрудник
    Когда я перехожу на страницу списка заказов
    Тогда я вижу кнопку "Удалить" только если у меня есть соответствующие права
    И я могу удалить заказ только при наличии прав

  Сценарий: Удаление заказа связанного с бронированием
    Дано заказ создан из бронирования
    Когда я удаляю заказ
    Тогда заказ удален из системы
    И бронирование остается в системе
    И связь между заказом и бронированием разрывается

  Сценарий: Попытка удаления несуществующего заказа
    Дано заказ с ID 999 не существует в системе
    Когда я пытаюсь удалить заказ с ID 999
    Тогда я вижу ошибку "Заказ не найден"
    И никакие данные не удаляются

  Сценарий: Удаление заказа обновляет кассовый отчет
    Дано существует кассовый отчет за дату заказа
    Когда я удаляю заказ
    Тогда кассовый отчет пересчитывается
    И сумма заказа вычитается из отчета

  Сценарий: Логирование удаления заказа
    Дано система ведет журнал операций
    Когда я удаляю заказ
    Тогда в журнал записывается событие удаления
    И запись содержит ID заказа
    И запись содержит ID пользователя, выполнившего удаление
    И запись содержит временную метку
