# language: ru

Функция: Управление оплатами заказа
  Как администратор системы
  Я хочу управлять оплатами заказов
  Чтобы отслеживать наличные и безналичные платежи

  Предыстория:
    Дано я авторизован как супер-администратор
    И в системе существует услуга "Боулинг" стоимостью 5000 рублей
    И в системе существует клиент "Иванов Иван Иванович"
    И в системе существует источник "Instagram"
    И существует заказ на сумму 10000 рублей

  Сценарий: Создание заказа с одной наличной оплатой
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля
    И добавляю оплату наличными на сумму 10000 рублей
    И сохраняю заказ
    Тогда заказ создан с оплатой наличными 10000 рублей
    И безналичная оплата составляет 0 рублей

  Сценарий: Создание заказа с одной безналичной оплатой
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля
    И добавляю оплату безналичными на сумму 10000 рублей
    И сохраняю заказ
    Тогда заказ создан с оплатой безналичными 10000 рублей
    И наличная оплата составляет 0 рублей

  Сценарий: Создание заказа со смешанной оплатой
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля
    И добавляю оплату наличными на сумму 6000 рублей
    Тогда безналичная часть автоматически устанавливается на 4000 рублей
    Когда я сохраняю заказ
    Тогда заказ создан с оплатой наличными 6000 рублей
    И заказ создан с оплатой безналичными 4000 рублей

  Сценарий: Автоматический расчет при вводе наличных
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля с суммой заказа 10000 рублей
    И ввожу в первую оплату наличные 3000 рублей
    Тогда безналичная часть автоматически устанавливается на 7000 рублей

  Сценарий: Автоматический расчет при вводе безналичных
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля с суммой заказа 10000 рублей
    И ввожу в первую оплату безналичные 8000 рублей
    Тогда наличная часть автоматически устанавливается на 2000 рублей

  Сценарий: Добавление нескольких оплат к заказу
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля с суммой заказа 10000 рублей
    И добавляю первую оплату наличными на сумму 5000 рублей
    И нажимаю "Добавить оплату"
    И добавляю вторую оплату наличными на сумму 3000 рублей
    И нажимаю "Добавить оплату"
    И добавляю третью оплату безналичными на сумму 2000 рублей
    И сохраняю заказ
    Тогда заказ создан с тремя оплатами
    И общая сумма оплат составляет 10000 рублей

  Сценарий: Валидация - сумма оплат меньше суммы заказа
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля с суммой заказа 10000 рублей
    И добавляю оплату наличными на сумму 8000 рублей
    И изменяю безналичную часть на 0 рублей
    И пытаюсь сохранить заказ
    Тогда я вижу ошибку "Сумма всех платежей (8000.00) должна быть равна сумме заказа (10000.00)"

  Сценарий: Валидация - сумма оплат больше суммы заказа
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля с суммой заказа 10000 рублей
    И нажимаю "Добавить оплату"
    И добавляю первую оплату наличными на сумму 10000 рублей
    И добавляю вторую оплату наличными на сумму 5000 рублей
    И пытаюсь сохранить заказ
    Тогда я вижу ошибку "Сумма всех платежей (15000.00) должна быть равна сумме заказа (10000.00)"

  Сценарий: Валидация - заказ без оплаты
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля
    И удаляю все оплаты
    И пытаюсь сохранить заказ
    Тогда я вижу ошибку "Необходимо добавить хотя бы один платеж"

  Сценарий: Дата оплаты соответствует дате заказа
    Когда я перехожу на страницу создания заказа
    И выбираю дату заказа "2024-01-20"
    И заполняю все обязательные поля
    И добавляю оплату наличными на сумму 10000 рублей
    И сохраняю заказ
    Тогда дата оплаты совпадает с датой заказа "2024-01-20"

  Сценарий: Редактирование оплат существующего заказа
    Дано существует заказ с оплатой наличными 10000 рублей
    Когда я открываю заказ для редактирования
    И изменяю наличную часть на 7000 рублей
    Тогда безналичная часть автоматически устанавливается на 3000 рублей
    Когда я сохраняю изменения
    Тогда оплата обновлена с наличными 7000 рублей
    И оплата обновлена с безналичными 3000 рублей

  Сценарий: Удаление оплаты из заказа
    Дано существует заказ с двумя оплатами
    Когда я открываю заказ для редактирования
    И удаляю вторую оплату
    И пытаюсь сохранить изменения
    Тогда я вижу ошибку о несоответствии суммы оплат
    И изменения не сохраняются

  Сценарий: Переключение флага "Наличные" в опциях
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля с суммой заказа 10000 рублей
    Тогда оплата по умолчанию безналичная
    Когда я включаю флаг "Наличные" в опциях
    Тогда первая оплата автоматически становится наличной 10000 рублей
    И безналичная часть обнуляется

  Сценарий: Создание заказа с нулевой суммой оплаты
    Когда я перехожу на страницу создания заказа
    И заполняю все обязательные поля
    И ввожу наличные 0 рублей
    И ввожу безналичные 0 рублей
    И пытаюсь сохранить заказ
    Тогда я вижу ошибку "Сумма всех платежей (0.00) должна быть равна сумме заказа"
