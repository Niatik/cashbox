# language: ru

Функция: Создание заказа
  Как администратор системы
  Я хочу создавать новые заказы
  Чтобы отслеживать оказанные услуги клиентам

  Предыстория:
    Дано я авторизован как супер-администратор
    И в системе существует услуга "Боулинг" стоимостью 5000 рублей
    И в системе существует клиент "Иванов Иван Иванович"
    И в системе существует источник "Instagram"
    И в системе существует время услуги "1 час" с коэффициентом 1.0

  Сценарий: Успешное создание простого заказа
    Когда я перехожу на страницу создания заказа
    И выбираю дату заказа "2024-01-15"
    И выбираю время заказа "14:00"
    И выбираю услугу "Боулинг"
    И выбираю время услуги "1 час"
    И указываю количество человек 2
    И выбираю источник "Instagram"
    И выбираю клиента "Иванов Иван Иванович"
    И добавляю оплату наличными на сумму 10000 рублей
    И сохраняю заказ
    Тогда я вижу сообщение "Заказ успешно создан"
    И в системе существует заказ с суммой 10000 рублей
    И заказ привязан к клиенту "Иванов Иван Иванович"

  Сценарий: Создание заказа с выбором количества человек через тариф
    Когда я перехожу на страницу создания заказа
    И выбираю услугу "Боулинг"
    И выбираю тариф "4 человека"
    И выбираю источник "Instagram"
    И выбираю клиента "Иванов Иван Иванович"
    Тогда количество человек устанавливается автоматически на 4
    И сумма заказа рассчитывается для 4 человек

  Сценарий: Создание заказа со скидкой
    Когда я перехожу на страницу создания заказа
    И выбираю услугу "Боулинг"
    И выбираю время услуги "1 час"
    И указываю количество человек 2
    И выбираю источник "Instagram"
    И выбираю клиента "Иванов Иван Иванович"
    И указываю скидку 1000 рублей
    И добавляю оплату наличными на сумму 9000 рублей
    И сохраняю заказ
    Тогда я вижу сообщение "Заказ успешно создан"
    И сумма к оплате составляет 9000 рублей
    И общая сумма заказа составляет 10000 рублей

  Сценарий: Создание заказа с авансом
    Когда я перехожу на страницу создания заказа
    И выбираю услугу "Боулинг"
    И выбираю время услуги "1 час"
    И указываю количество человек 2
    И выбираю источник "Instagram"
    И выбираю клиента "Иванов Иван Иванович"
    И указываю аванс 3000 рублей
    И добавляю оплату наличными на сумму 7000 рублей
    И сохраняю заказ
    Тогда я вижу сообщение "Заказ успешно создан"
    И сумма к оплате составляет 7000 рублей
    И общая сумма заказа составляет 10000 рублей

  Сценарий: Создание заказа с дополнительной скидкой
    Когда я перехожу на страницу создания заказа
    И выбираю услугу "Боулинг"
    И выбираю время услуги "1 час"
    И указываю количество человек 2
    И выбираю источник "Instagram"
    И выбираю клиента "Иванов Иван Иванович"
    И указываю дополнительную скидку 500 рублей с причиной "День рождения"
    И добавляю оплату наличными на сумму 9500 рублей
    И сохраняю заказ
    Тогда я вижу сообщение "Заказ успешно создан"
    И сумма к оплате составляет 9500 рублей
    И в опциях заказа сохранена причина скидки "День рождения"

  Сценарий: Создание нового клиента при создании заказа
    Когда я перехожу на страницу создания заказа
    И нажимаю "Создать нового клиента"
    И ввожу имя клиента "Петров Петр Петрович"
    И ввожу телефон клиента "+7 999 123-45-67"
    И сохраняю нового клиента
    Тогда клиент "Петров Петр Петрович" появляется в списке
    И я могу выбрать этого клиента для заказа

  Сценарий: Создание новой услуги при создании заказа
    Когда я перехожу на страницу создания заказа
    И нажимаю "Создать новую услугу"
    И ввожу название услуги "Бильярд"
    И ввожу описание "Русский бильярд"
    И ввожу цену 3000 рублей
    И сохраняю новую услугу
    Тогда услуга "Бильярд" появляется в списке
    И я могу выбрать эту услугу для заказа

  Сценарий: Валидация - создание заказа без обязательных полей
    Когда я перехожу на страницу создания заказа
    И пытаюсь сохранить заказ без заполнения полей
    Тогда я вижу ошибку "Поле 'Услуга' обязательно для заполнения"
    И я вижу ошибку "Поле 'Источник' обязательно для заполнения"
    И я вижу ошибку "Необходимо добавить хотя бы один платеж"
    И заказ не сохраняется

  Сценарий: Валидация - сумма платежей не соответствует сумме заказа
    Когда я перехожу на страницу создания заказа
    И выбираю услугу "Боулинг"
    И выбираю время услуги "1 час"
    И указываю количество человек 2
    И выбираю источник "Instagram"
    И выбираю клиента "Иванов Иван Иванович"
    И добавляю оплату наличными на сумму 5000 рублей
    И пытаюсь сохранить заказ
    Тогда я вижу ошибку "Сумма всех платежей (5000.00) должна быть равна сумме заказа (10000.00)"
    И заказ не сохраняется

  Сценарий: Автоматический расчет при изменении количества человек
    Когда я перехожу на страницу создания заказа
    И выбираю услугу "Боулинг"
    И выбираю время услуги "1 час"
    И указываю количество человек 2
    Тогда сумма заказа автоматически пересчитывается на 10000 рублей
    Когда я изменяю количество человек на 3
    Тогда сумма заказа автоматически пересчитывается на 15000 рублей

  Сценарий: Дата заказа доступна только для администратора
    Дано я авторизован как сотрудник
    Когда я перехожу на страницу создания заказа
    Тогда поле "Дата заказа" скрыто для меня
    И дата заказа автоматически устанавливается на сегодня

  Сценарий: Время заказа установлено только для чтения
    Когда я перехожу на страницу создания заказа
    Тогда поле "Время заказа" доступно только для чтения
    И время заказа автоматически устанавливается на текущее время
